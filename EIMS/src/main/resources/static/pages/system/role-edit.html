<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>角色信息</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,role-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
<link rel="stylesheet" href="/layui/css/layui.css" media="all">
<link rel="stylesheet" href="/css/edit.css" media="all">
<link rel="stylesheet" href="/layui/lay/mymodules/eleTree.css" media="all">
</head>
<body>
<div id="roleEdit">
	<div class="layui-tab">
	    <ul class="layui-tab-title">
		    <li class="layui-this">角色信息</li>
		    <li v-if="role && role.id">角色菜单</li>
	    </ul>
	    <div class="layui-tab-content">
	   	  <div class="layui-tab-item layui-show">
			<form class="layui-form">
				<div class="layui-form-item">
					<label class="layui-form-label"><span style="color: red">*</span>角色名</label>
					<div class="layui-input-inline" v-if="!isView">
						<input type="text" v-model="role.name" required lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input">
					</div>
					<div class="my-form-label" v-if="isView">
						{{role.name}}
					</div>
				</div>
				<div class="layui-form-item layui-form-text">
				    <label class="layui-form-label">备注</label>
				    <div class="layui-input-block" v-if="!isView">
				      <textarea v-model="role.remarks" placeholder="请输入内容" class="layui-textarea"></textarea>
				    </div>
				    <div class="layui-input-block" v-if="isView">
						<textarea v-model="role.remarks" class="layui-textarea" readonly="readonly"></textarea>
					</div>
				 </div>
				 <div class="layui-form-item" v-if="!isView">
				    <div class="layui-input-block submit-block">
				      <button class="layui-btn" lay-submit lay-filter="roleForm">立即提交</button>
				      <a href="javascript:closeIframe();" class="layui-btn layui-btn-primary">关闭</a>
				    </div>
				  </div>
			</form>
		</div>
		<div class="layui-tab-item" v-if="role && role.id">
		    	<form class="layui-form">
			    	<div class="eleTree ele1" lay-filter="roleMenu"></div>
					  <div class="layui-form-item" v-if="!isView">
					    <div class="layui-input-block submit-block">
					      <button class="layui-btn" lay-submit lay-filter="authForm">立即提交</button>
					      <a href="javascript:closeIframe();" class="layui-btn layui-btn-primary">关闭</a>
					    </div>
					  </div>
				</form>
		    </div>
		</div>
	</div>
</div>
</div>
<script src="/layui/layui.js"></script>
<script src="/js/vue.js"></script>
<script src="/js/jquery-min-1.11.3.js"></script>
<script src="/js/common.js"></script>
<script>
layui.use(['layer','form','element'], function(){
    var layer = layui.layer;
    var form = layui.form;
    element = layui.element;
	form.on('submit(roleForm)', function(data){
		  roleInfo.submit();
		  return false; //阻止表单跳转。如果需要表单跳转，去掉这段即可。
		});
});
//layui扩展tree组件，用于展示角色菜单
layui.config({
    base: "/layui/lay/mymodules/"        //eleTree.js所在目录
}).use(['jquery','eleTree'], function(){
    var $ = layui.jquery;
    var eleTree = layui.eleTree;
    var el;
    var id=getQueryString("id");
     $.ajax({
        url: "/menu/tree",
        type: 'post',
        data: {roleId : id},
        dataType: 'json',
        success: function (res) {
            var data=res.list;
            el=eleTree.render({
                elem: '.ele1',
                data: data,
                defaultExpandAll: true,
                response: {
                	code: "code",
                    statusCode: 0,
                    data: "data",
                },
                request: {     // 对后台返回的数据格式重新定义
                	name: "name",
                    key: "id",
                    children: "children",
                    checked: "checked",
                },
                showCheckbox: true,
                drag: false,
                accordion: false
            });
        },
        error: function (msg) {
            console.log("tree错误")
        }
    }); 
})

//用于判断页面当前是编辑页还是展示页
var isView = getQueryString("isView") || false;
	
//获取和保存角色信息
var roleInfo = new Vue({
	el : '#roleEdit',
	data : {
		role : {},
		isView : isView,
	},
	methods : {
		submit : function() {
				$.post('/role/save',this.role, function(res) {
					if(jQuery.parseJSON(res).success){
						roleInfo.role=jQuery.parseJSON(res);
						layer.msg("保存成功");
					}else{
						layer.msg("发生错误");
					}
				});
		},
		getRole : function(id) {
			$.get('/role/'+id, function(res) {
				roleInfo.role = jQuery.parseJSON(res);
			});
		}
	},
	created : function() {
		var id=getQueryString("id");
		if(id != null){
			this.getRole(id);
		}
	},
})
</script>
</body>
</html>